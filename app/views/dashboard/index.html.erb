<div class="min-h-screen bg-gradient-to-b from-purple-50 to-pink-50 py-12 px-4">
  <div class="max-w-5xl mx-auto text-center">

    <!-- NORMAL DASHBOARD (when alive) -->
    <% unless current_user.pet&.dead? %>
      <h1 class="text-5xl font-bold mb-8 text-gray-800">
        Welcome back, <%= current_user.email.split("@").first.capitalize %>!
      </h1>

      <!-- PET + SPECIES + EVOLUTION INFO -->
      <div class="my-12 text-center">
        <div class="text-9xl animate-bounce inline-block">
          <%= current_user.pet&.emoji %>
        </div>

        <p class="text-4xl font-bold mt-8 text-gray-800">
          <%= current_user.pet&.name %> feels <span class="text-purple-600"><%= current_user.pet&.mood.to_s.upcase %></span>
        </p>

        <div class="mt-6">
          <p class="text-2xl text-gray-700">
            Species: <span class="font-bold text-indigo-600 text-3xl"><%= current_user.pet&.species_name %></span>
          </p>

          <% next_species_entry = current_user.pet ? Pet::SPECIES.find { |_, data| data[:unlock] > current_user.longest_streak } : nil %>
          <% if next_species_entry && current_user.longest_streak < 365 %>
            <p class="text-xl text-gray-600 mt-3">
              Next → <span class="font-bold text-purple-600"><%= next_species_entry[1][:name] %></span>
              at <%= next_species_entry[1][:unlock] %> days
            </p>
          <% else %>
            <p class="text-3xl font-bold bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 bg-clip-text text-transparent mt-4 animate-pulse">
              Rainbow Unicorn — You are a legend
            </p>
          <% end %>
        </div>

        <% if flash[:resurrected] %>
          <div class="mt-12 animate-pulse">
            <p class="text-6xl font-black text-yellow-400 drop-shadow-2xl">BACK FROM THE DEAD</p>
            <p class="text-3xl text-yellow-300 mt-3 font-bold">+20 levels • Immortal status unlocked</p>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- DEATH SCREEN -->
    <% if current_user.pet&.dead? %>
      <div class="my-24">
        <div class="text-9xl mb-8">Tombstone</div>
        <h1 class="text-6xl font-black text-gray-800 mb-8"><%= current_user.pet.name %> has died</h1>
        <p class="text-3xl text-gray-600 mb-12">"You forgot to feed me..." — <%= current_user.pet.name %></p>
        <p class="text-2xl text-red-700 font-bold">Complete 7 perfect days to bring them back!</p>
      </div>
    <% end %>

    <!-- TODAY'S HABITS -->
    <div class="my-12">
      <h2 class="text-3xl font-bold mb-8">
        <%= current_user.pet&.dead? ? "Fight to bring them back!" : "Today's Habits" %>
      </h2>

      <% if current_user.habits.any? %>
        <div class="space-y-6 max-w-2xl mx-auto">
          <% current_user.habits.each do |habit| %>
            <%= button_to toggle_habit_path(habit), method: :patch,
                class: "block p-8 rounded-3xl shadow-xl transition #{habit.completed_today? ? 'bg-green-100 border-4 border-green-400' : 'bg-white hover:bg-gray-50'}" do %>
              <div class="flex items-center justify-between">
                <div class="text-left">
                  <span class="text-5xl mr-4"><%= habit.emoji %></span>
                  <span class="text-2xl font-medium"><%= habit.name %></span>
                </div>
                <div class="text-7xl">
                  <%= habit.completed_today? ? "✓" : "○" %>
                </div>
              </div>
            <% end %>

            <!-- EDIT/DELETE LINKS below each habit -->
            <div class="text-center mt-2 space-x-4">
              <%= link_to edit_habit_path(habit), class: "text-gray-500 hover:text-purple-600 transition text-sm" do %>
                Edit
              <% end %>
              <%= button_to habit_path(habit), method: :delete,
                    data: { turbo_confirm: "Do you really want to delete this habit?" },
                    class: "text-red-500 hover:text-red-700 transition text-sm" do %>
                Delete
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-xl text-gray-600">No habits yet — add your first one below!</p>
      <% end %>
    </div>

    <!-- BUTTONS — ALWAYS VISIBLE -->
    <div class="mt-16 space-x-8">
      <%= link_to "Add New Habit", new_habit_path,
          class: "bg-indigo-600 hover:bg-indigo-700 text-white text-2xl px-12 py-6 rounded-full shadow-2xl transition font-bold" %>

      <%= button_to "Log out", destroy_user_session_path, method: :delete,
          class: "bg-red-600 hover:bg-red-700 text-white text-2xl px-12 py-6 rounded-full shadow-2xl transition font-bold" %>
    </div>

  </div>
</div>

<!-- Confetti + Sound on resurrection -->
<% if flash[:resurrected] %>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script>
    new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3').play();
    confetti({ particleCount: 300, spread: 120, origin: { y: 0.6 } });
    setTimeout(() => confetti({ particleCount: 100, angle: 60, origin: { x: 0 } }), 250);
    setTimeout(() => confetti({ particleCount: 100, angle: 120, origin: { x: 1 } }), 400);
  </script>
<% end %>