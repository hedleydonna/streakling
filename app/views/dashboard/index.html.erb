<div class="min-h-screen bg-gradient-to-b from-purple-50 to-pink-50 py-12 px-4">
  <div class="max-w-5xl mx-auto text-center">

    <!-- NORMAL DASHBOARD (when alive) -->
    <% unless current_user.pet&.dead? %>
      <h1 class="text-5xl font-bold mb-8 text-gray-800">
        Welcome back, <%= current_user.email.split("@").first.capitalize %>!
      </h1>

      <!-- PET + SPECIES + EVOLUTION INFO -->
      <div class="my-12 text-center">
      <div class="<%= current_user.pet.size_class %> animate-bounce inline-block">
        <%= current_user.pet.emoji %>
      </div>
    
      <p class="text-5xl font-bold mt-10 text-gray-800">
        <%= current_user.pet.name %> is a <span class="text-purple-600"><%= current_user.pet.stage_name %></span>
      </p>
    
      <p class="text-3xl font-medium mt-6 text-gray-700 italic">
        "<%= current_user.pet.message %>"
      </p>
    
      <% if current_user.pet.dead? %>
        <p class="text-4xl text-red-700 mt-8 font-bold">Sparkles has died…</p>
        <p class="text-2xl text-gray-600">Complete 7 perfect days to bring them back!</p>
      <% else %>
        <p class="text-4xl font-bold mt-8 text-gray-800">
          <%= current_user.pet.name %> feels <span class="text-purple-600"><%= current_user.pet.mood.to_s.upcase %></span>
        </p>
      <% end %>

      <div class="mt-6">
  <% total_habits = current_user.habits.count %>
  <% completed_today = current_user.habits.where(completed_on: Time.zone.today).count %>
  <% percentage = total_habits.zero? ? 100 : (completed_today * 100 / total_habits) %>

  <p class="text-3xl font-bold text-gray-800 mb-4">
    Today's Score: <span class="text-indigo-600"><%= percentage %>%</span>
  </p>

  <p class="text-xl text-gray-600 mb-8">
    You completed <%= completed_today %> out of <%= total_habits %> habits today.
  </p>

  <% if percentage < 100 %>
    <p class="text-2xl text-red-600 font-bold mb-4">
      To improve:
    </p>
    <ul class="text-left max-w-md mx-auto space-y-2">
      <% current_user.habits.where.not(completed_on: Time.zone.today).each do |habit| %>
        <li class="text-lg text-gray-700">
          <%= habit.emoji %> <%= habit.name %> — not done today
        </li>
      <% end %>
    </ul>
    <p class="mt-6 text-xl text-gray-700">
      Finish the ones above to make Sparkles happy and keep your streak!
    </p>
  <% else %>
    <p class="text-3xl text-green-600 font-bold">
      Perfect Day! Sparkles is thriving.
    </p>
  <% end %>
</div>

<div class="mt-8 p-8 bg-gradient-to-r from-purple-100 to-pink-100 rounded-3xl">
  <p class="text-4xl font-bold text-purple-800">
    Lifetime Points: <%= current_user.daily_points %>
  </p>
  <p class="text-2xl text-gray-700 mt-4">
    Every 10 points = 1 day toward Sparkles' growth
  </p>
  <p class="text-5xl font-black text-indigo-600 mt-6">
    Current Streak: <%= current_user.current_streak %> days
  </p>
</div>
    
      <% if flash[:resurrected] %>
        <div class="mt-12 animate-pulse">
          <p class="text-7xl font-black text-yellow-400 drop-shadow-2xl">BACK FROM THE DEAD</p>
          <p class="text-4xl text-yellow-300 mt-4 font-bold">+20 levels • Your bond is unbreakable</p>
        </div>
      <% end %>
    </div>
    <% end %>

    <!-- DEATH SCREEN -->
    <% if current_user.pet&.dead? %>
      <div class="my-24">
        <div class="text-9xl mb-8">Tombstone</div>
        <h1 class="text-6xl font-black text-gray-800 mb-8"><%= current_user.pet.name %> has died</h1>
        <p class="text-3xl text-gray-600 mb-12">"You forgot to feed me..." — <%= current_user.pet.name %></p>
        <p class="text-2xl text-red-700 font-bold">Complete 7 perfect days to bring them back!</p>
      </div>
    <% end %>

    <!-- TODAY'S HABITS -->
    <div class="my-12">
      <h2 class="text-3xl font-bold mb-8">
        <%= current_user.pet&.dead? ? "Fight to bring them back!" : "Today's Habits" %>
      </h2>

      <% if current_user.habits.any? %>
        <div class="space-y-6 max-w-2xl mx-auto">
          <% current_user.habits.each do |habit| %>
            <%= button_to toggle_habit_path(habit), method: :patch,
                class: "block p-8 rounded-3xl shadow-xl transition #{habit.completed_today? ? 'bg-green-100 border-4 border-green-400' : 'bg-white hover:bg-gray-50'}" do %>
              <div class="flex items-center justify-between">
                <div class="text-left">
                  <span class="text-5xl mr-4"><%= habit.emoji %></span>
                  <span class="text-2xl font-medium"><%= habit.name %></span>
                </div>
                <div class="text-7xl">
                  <%= habit.completed_today? ? "✓" : "○" %>
                </div>
              </div>
            <% end %>

            <!-- EDIT/DELETE LINKS below each habit -->
            <div class="text-center mt-2 space-x-4">
              <%= link_to edit_habit_path(habit), class: "text-gray-500 hover:text-purple-600 transition text-sm" do %>
                Edit
              <% end %>
              <%= button_to habit_path(habit), method: :delete,
                    data: { turbo_confirm: "Do you really want to delete this habit?" },
                    class: "text-red-500 hover:text-red-700 transition text-sm" do %>
                Delete
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-xl text-gray-600">No habits yet — add your first one below!</p>
      <% end %>
    </div>

    <!-- BUTTONS — ALWAYS VISIBLE -->
    <div class="mt-16 space-x-8">
      <%= link_to "Add New Habit", new_habit_path,
          class: "bg-indigo-600 hover:bg-indigo-700 text-white text-2xl px-12 py-6 rounded-full shadow-2xl transition font-bold" %>

      <%= button_to "Log out", destroy_user_session_path, method: :delete,
          class: "bg-red-600 hover:bg-red-700 text-white text-2xl px-12 py-6 rounded-full shadow-2xl transition font-bold" %>
    </div>

  </div>
</div>

<!-- Confetti + Sound on resurrection -->
<% if flash[:resurrected] %>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script>
    new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3').play();
    confetti({ particleCount: 300, spread: 120, origin: { y: 0.6 } });
    setTimeout(() => confetti({ particleCount: 100, angle: 60, origin: { x: 0 } }), 250);
    setTimeout(() => confetti({ particleCount: 100, angle: 120, origin: { x: 1 } }), 400);
  </script>
<% end %>